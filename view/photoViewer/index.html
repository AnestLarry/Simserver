<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Photo Viewer - Simserver</title>
  <style>
    body {
      background-color: #f2f2f2;
      font-size: 16px;
      color: #333;
    }

    body + body * {
      margin: 0;
      padding: 0;
    }

    #url {
      width: 80%;
      font-size: larger;
    }

    #viewMode{
      width:17%;
      font-size: larger;
    }

    #left {
      float: left;
      background-color: #fff;
      width: 20%;
      display: inline-block;
      overflow: hidden;
    }

    #left ul {
      margin: 0;
      padding: 0;
    }

    #left li {
      margin: 5 0;
      list-style: none;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .curli {
      background-color: #aaa;
    }

    #left li:hover {
      background-color: #f2f2f2;
    }

    #right {
      min-height: 100px;
      float: right;
      background-color: #fff;
      width: 78%;
      display: inline-block;
      padding: 2px;
      box-sizing: border-box;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }

    #right img {
      margin: 0 auto;
    }

    .imgWidth1st{
      width: 100%;
    }

    .imgHeight1st{
      height: 100%;
    }

    .leftS {
      height: 0 !important;
      width: 0 !important;
    }

    .rightL {
      height: 100% !important;
      width: 100% !important;
    }
  </style>
</head>
<body>
  <div id="topNav">
<input id="url" value="/" onblur="updateData(this)"/>
<select id="viewMode" multiple onchange="viewModeChange(this)"> 
  <optgroup label="img rest">
    <option value="Height">Height 1st</option>
    <option value="Width">Width 1st</option>
  </optgroup>
  <optgroup label="img nums">
    <option value="img_1">1</option>
    <option value="img_2">multiple</option>
  </optgroup>
</select>
</div>

<div class="all">
  <div id="left">
    <ul id="leftUl"></ul>
  </div>
  <div id="right" onmouseleave="LargePhotoMode(false)" onmouseenter="LargePhotoMode(true)">
    <img id="show" name="showImgs" class="imgHeight1st" src="#" onclick="nextImg()">
  </div>
</div>
<script>
    var baseUrl = window.location.protocol + "//" + window.location.host;
    var fileList = [];
    var showIndex = 0;
    if (window.location.search.length !== 0) {
        var path = window.location.search.indexOf("path")+5;
        if (window.location.search.indexOf("&", path) === -1) {
            document.getElementById("url").value = "/" + window.location.search.substring(path);
        } else {
            document.getElementById("url").value = "/" + window.location.search.substring(path, window.location.search.indexOf("&", path));
        }
    }

    function updateData(u) {
        var imgExt = ["png", "jpg", "jpeg", "webp", "gif", "bmp", "avif", "heif", "svg"];
        var url = baseUrl + "/api/dl/ls/" + u.value;
        var data = JSON.parse(httpGet(url));
        fileList = [];
        showIndex = 0
        var lU = document.getElementById("leftUl");
        lU.innerHTML = "";
        data["fileList"].sort(function (a, b) {
            if (a.Name.length !== b.Name.length) {
                return a.Name.length < b.Name.length ? -1 : 1;
            } else {
                return a.Name.substring(0, a.Name.lastIndexOf(".")) < b.Name.substring(0, b.Name.lastIndexOf(".")) ? a : b;
            }
        });
        for (let file_i = 0; file_i < data["fileList"].length; file_i++) {
            let file = data["fileList"][file_i];
            for (let ei = 0; ei < imgExt.length; ei++) {
                if (file.Name.toLowerCase().endsWith(imgExt[ei])) {
                    var n = document.createElement("li");
                    n.setAttribute("i", file_i.toString());
                    n.innerText = file["Name"];
                    n.setAttribute("onclick", "updateImg(" + fileList.length + ")");
                    lU.appendChild(n);
                    fileList.push(file);
                    break;
                }
            }
        }
        {
          // update chain
          updateImg(0);
          viewModeChange(document.getElementById("viewMode"))
        }
    }

    function updateImg(i) {
        showIndex = i;
        document.getElementById("show").src = baseUrl + "/api/dl/n/" + document.getElementById("url").value + (document.getElementById("url").value.endsWith("/")?"":"/") + fileList[i].Name;
        document.getElementById("show").style.height = window.innerHeight;
        var lis = document.getElementById("left").getElementsByTagName("li");
        for (let i = 0; i < lis.length; i++) {
            lis[i].setAttribute("class", i === showIndex ? "curli" : "");
        }
    }

    function nextImg() {
        if (showIndex < fileList.length) {
            updateImg(++showIndex);
        } else {
            showIndex = 0;
            updateImg(showIndex);
        }
    }

    function LargePhotoMode(b) {
        if (b) {
            document.getElementById("topNav").setAttribute("class","leftS");
            document.getElementById("left").setAttribute("class", "leftS");
            document.getElementById("right").setAttribute("class", "rightL");
        } else {
            document.getElementById("topNav").setAttribute("class","");
            document.getElementById("left").setAttribute("class", "");
            document.getElementById("right").setAttribute("class", "");
        }
    }

    function viewModeChange(a) {
      for(let i = 0; i < a.selectedOptions.length; i++){
        const e = a.selectedOptions[i];
        switch(e.value){
          case "Width":
            for (let i = 0; i < document.getElementsByName("showImgs").length; i++) {
              const element = document.getElementsByName("showImgs")[i];
              element.setAttribute("class", "imgWidth1st");
            }
            break;
          case "Height":
          for (let i = 0; i < document.getElementsByName("showImgs").length; i++) {
              const element = document.getElementsByName("showImgs")[i];
              element.setAttribute("class", "imgHeight1st");
            }
            break;
          case "img_1":
            console.log("clear img")
            for (let i = 1; i < document.getElementsByName("showImgs").length;) {
              console.log("clear "+i);
              const element = document.getElementsByName("showImgs")[i];
              element.remove();
            }
            break;
          case "img_2":
            document.getElementsByName("showImgs")[0] = baseUrl + "/api/dl/n/" + document.getElementById("url").value + (document.getElementById("url").value.endsWith("/")?"":"/") + fileList[0].Name;
            for (let i = 1; i < document.getElementsByName("showImgs").length; i++) {
              document.getElementsByName("showImgs")[i].remove();
            }
            for (let i = 1; i < fileList.length; i++) {
              var n = document.createElement("img");
              n.name="showImgs";
              const element = fileList[i];
              n.src = baseUrl + "/api/dl/n/" + document.getElementById("url").value + (document.getElementById("url").value.endsWith("/")?"":"/") + element.Name;
              document.getElementById("right").appendChild(n);
            }
          default:
            break;
        }
      }
    }

    function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }
</script>
</body>
</html>